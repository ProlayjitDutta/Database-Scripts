CREATE OR REPLACE FUNCTION func_tracker_save_orders_embroidery(
    IN v_embrd_order_no VARCHAR(500),
    IN v_embrd_requisition_id int,
    IN v_embrd_custom_requisition_id int,
    IN v_custom_requisition char(1),
    IN v_approve char(1),
    OUT output_msg text,
    OUT id integer)
  RETURNS record AS
$BODY$
BEGIN   
					
		IF v_approve='Y' THEN
			INSERT INTO tracker_orders_embroidery (
			  embrd_order_no,
			  embrd_requisition_id,
			  embrd_custom_requisition_id
			)
			VALUES(			
			$1,
			$2,
			$3
			) RETURNING order_id into id;
		END IF;
			
		IF v_approve='Y' THEN
			IF v_custom_requisition='N' THEN
				UPDATE TRACKER_REQUISITION_EMBROIDERY SET approved='Y' WHERE embrd_requisition_id=v_embrd_requisition_id;
				output_msg:='Successfully Updated';	
			ELSIF v_custom_requisition='Y' THEN
				UPDATE TRACKER_CUSTOM_REQUISITION_EMBROIDERY SET approved='Y' WHERE embrd_custom_requisition_id=v_embrd_custom_requisition_id;
				output_msg:='Successfully Updated';	
			END IF;
		ELSIF v_approve='N' THEN
			IF v_custom_requisition='N' THEN
				UPDATE TRACKER_REQUISITION_EMBROIDERY SET approved='N' WHERE embrd_requisition_id=v_embrd_requisition_id;
				output_msg:='Successfully Updated';	
			ELSIF v_custom_requisition='Y' THEN
				UPDATE TRACKER_CUSTOM_REQUISITION_EMBROIDERY SET approved='N' WHERE embrd_custom_requisition_id=v_embrd_custom_requisition_id;
				output_msg:='Successfully Updated';	
			END IF;
		END IF;
		
END
$BODY$
  LANGUAGE plpgsql;
