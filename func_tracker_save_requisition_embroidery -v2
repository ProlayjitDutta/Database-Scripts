CREATE OR REPLACE FUNCTION func_tracker_save_requisition_embroidery(
	IN v_issue_min_date date,
	IN v_issue_max_date date,
	IN v_transaction_id VARCHAR(100),
	IN v_delivery_min_date date,
	IN v_delivery_max_date date,
	IN v_category_name text,
	IN v_style_code VARCHAR(50),
	IN v_designer_code VARCHAR(20),
	IN v_color_code VARCHAR(10),
	IN v_product_codes VARCHAR(500),
	IN v_item_code VARCHAR(50),
	IN v_production_types VARCHAR(200),
	IN v_embrd_total_metre float,
	IN v_embrd_total_pcs integer,
	IN v_embrd_total_set integer,
	IN v_embrd_total_line float,
	IN v_embrd_total_length_inch1 float,
	IN v_embrd_total_width_inch2 float,
	IN v_embrd_total_height_inch3 float,
	IN v_embrd_total_measurement float,
	IN v_embrd_code VARCHAR(20),
	IN v_embrd_desc text,
	IN v_embrd_std_unit text,
	IN v_fabric_name VARCHAR(100),
	IN v_fabric_base_colour VARCHAR(10),
	IN v_material_reference text,
	IN v_sc_planning_main_item_id int,
	IN v_style_ccode_id int,
	IN v_sc_asis_plan_print_item_id int,
	IN v_cat_custom_plan_print_item_id int,
	IN v_sc_custom_dept_plan_print_item_id int,
	IN v_sc_custom char(1),
	IN v_sc_dept_changed char(1),
	IN v_custom_requisition char(1) DEFAULT NULL,
    IN v_custom_embrd_total_metre float[] DEFAULT NULL::float[],
    IN v_custom_embrd_total_pcs integer[] DEFAULT NULL::integer[],
    IN v_custom_embrd_total_set integer[] DEFAULT NULL::integer[],
    IN v_custom_embrd_total_line float[] DEFAULT NULL::float[],
    IN v_custom_embrd_total_length_inch1 float[] DEFAULT NULL::float[],
    IN v_custom_embrd_total_width_inch2 float[] DEFAULT NULL::float[],
    IN v_custom_embrd_total_height_inch3 float[] DEFAULT NULL::float[],
    IN v_custom_embrd_total_measurement float[] DEFAULT NULL::float[],
    OUT output_msg text,
    OUT id integer)
  RETURNS record AS
$BODY$
BEGIN   
					
		INSERT INTO tracker_requisition_embroidery (
			  issue_min_date,
			  issue_max_date,
			  transaction_id,
			  delivery_min_date,
			  delivery_max_date,
			  category_name,
			  style_code,
			  designer_code,
			  color_code,
			  product_codes,
			  item_code,
			  production_types,
			  embrd_total_metre,
			  embrd_total_pcs,
			  embrd_total_set,
			  embrd_total_line,
			  embrd_total_length_inch1,
			  embrd_total_width_inch2,
			  embrd_total_height_inch3,
			  embrd_total_measurement,
			  embrd_code,
			  embrd_desc,
			  embrd_std_unit,
			  fabric_name,
			  fabric_base_colour,
			  material_reference,			
			  sc_planning_main_item_id,
			  style_ccode_id,
			  sc_asis_plan_print_item_id,
			  cat_custom_plan_print_item_id,
			  sc_custom_dept_plan_print_item_id,
			  sc_custom,
			  sc_dept_changed
		)
		VALUES(			
		$1,
		$2,
		$3,
		$4,
		$5,
		$6,
		$7,
		$8,
		$9,
		$10,
		$11,
		$12,
		$13,
		$14,
		$15,
		$16,
		$17,
		$18,
		$19,
		$20,
		$21,
		$22,
		$23,
		$24,
		$25,
		$26,
		$27,
		$28,
		$29,
		$30,
		$31,
		$32,
		$33
		) RETURNING embrd_requisition_id into id;
		output_msg:='Successfully inserted';	


		IF v_custom_requisition='Y' THEN
			
		    INSERT INTO TRACKER_CUSTOM_REQUISITION_EMBROIDERY(
			embrd_requisition_id,
			embrd_total_metre,
			embrd_total_pcs,
			embrd_total_set,
			embrd_total_line,
			embrd_total_length_inch1,
			embrd_total_width_inch2,
			embrd_total_height_inch3,
			embrd_total_measurement
			) 		
			select 
			id,
			UNNEST(v_custom_embrd_total_metre::float[]),
			UNNEST(v_custom_embrd_total_pcs::integer[]),
			UNNEST(v_custom_embrd_total_set::integer[]),
			UNNEST(v_custom_embrd_total_line::float[]),
			UNNEST(v_custom_embrd_total_length_inch1::float[]),
			UNNEST(v_custom_embrd_total_width_inch2::float[]),
			UNNEST(v_custom_embrd_total_height_inch3::float[]),
			UNNEST(v_custom_embrd_total_measurement::float[]);
			
			UPDATE tracker_requisition_embroidery SET custom_requisition='Y' WHERE embrd_requisition_id=id;

		END IF;
	
END
$BODY$
  LANGUAGE plpgsql;
