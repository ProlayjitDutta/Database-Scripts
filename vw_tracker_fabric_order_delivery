CREATE OR REPLACE VIEW vw_tracker_fabric_order_delivery AS 
 SELECT requis.fabric_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.fabric_code,
    requis.fabric_name,
    requis.fabric_type,
    requis.fabric_length,
    requis.fabric_width,
    requis.fabric_shrinkage,
    requis.fabric_pcs,
    requis.fabric_total_measurement,
    requis.sc_planning_main_item_id,
    requis.style_ccode_id,
    requis.sc_asis_plan_fabric_item_id,
    requis.sc_custom_plan_fabric_item_id,
    requis.sc_custom_dept_plan_fabric_item_id,
    requis.sc_custom,
    requis.sc_dept_changed,
    requis.approved,
    orders.order_id,
    orders.fabric_order_no,
    orders.customized,
    0 AS custom_fabric_length,
    0 AS custom_fabric_width,
    0 AS custom_fabric_shrinkage,
    0 AS custom_fabric_pcs,
    0 AS custom_fabric_total_measurement
   FROM tracker_orders_fabric orders
     JOIN tracker_requisition_fabric requis ON orders.fabric_requisition_id = requis.fabric_requisition_id
  WHERE orders.issued = 'Y'::bpchar AND orders.delivered IS NULL
UNION ALL
 SELECT requis.fabric_requisition_id,
    requis.issue_min_date,
    requis.issue_max_date,
    requis.transaction_id,
    requis.delivery_min_date,
    requis.delivery_max_date,
    requis.category_name,
    requis.style_code,
    requis.designer_code,
    requis.color_code,
    requis.product_codes,
    requis.item_code,
    requis.production_types,
    requis.fabric_code,
    requis.fabric_name,
    requis.fabric_type,
    requis.fabric_length,
    requis.fabric_width,
    requis.fabric_shrinkage,
    requis.fabric_pcs,
    requis.fabric_total_measurement,
    requis.sc_planning_main_item_id,
    requis.style_ccode_id,
    requis.sc_asis_plan_fabric_item_id,
    requis.sc_custom_plan_fabric_item_id,
    requis.sc_custom_dept_plan_fabric_item_id,
    requis.sc_custom,
    requis.sc_dept_changed,
    requis.approved,
    orders.order_id,
    orders.fabric_order_no,
    orders.customized,
    custom_orders.fabric_length AS custom_fabric_length,
    custom_orders.fabric_width AS custom_fabric_width,
    custom_orders.fabric_shrinkage AS custom_fabric_shrinkage,
    custom_orders.fabric_pcs AS custom_fabric_pcs,
    custom_orders.fabric_total_measurement AS custom_fabric_total_measurement
   FROM tracker_custom_orders_fabric custom_orders
     JOIN tracker_orders_fabric orders ON orders.order_id = custom_orders.order_id
     JOIN tracker_requisition_fabric requis ON orders.fabric_requisition_id = requis.fabric_requisition_id
  WHERE custom_orders.issued::text = 'Y'::text AND custom_orders.delivered IS NULL;
